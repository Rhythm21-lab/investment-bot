<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Investment Chatbot</title>

  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f5f7fa;
      margin: 0;
      padding: 0;
    }

    /* Main chat container */
    .chat-wrapper {
      max-width: 900px;
      margin: 40px auto;
      background: white;
      border-radius: 10px;
      box-shadow: 0 4px 15px rgba(0,0,0,0.1);
      display: flex;
      flex-direction: column;
      height: 85vh;
    }

    /* Header */
    .chat-header {
      padding: 15px;
      background: #2563eb;
      color: white;
      font-size: 18px;
      font-weight: bold;
      border-radius: 10px 10px 0 0;
    }

    /* Chat messages */
    #chat {
      flex: 1;
      padding: 20px;
      overflow-y: auto;
      display: flex;
      flex-direction: column;
      gap: 12px;
    }

    /* Bot bubble */
    .bot {
      align-self: flex-start;
      background: #eef2ff;
      padding: 10px 14px;
      border-radius: 10px;
      max-width: 75%;
      color: #1e3a8a;
    }

    /* User bubble */
    .user {
      align-self: flex-end;
      background: #dcfce7;
      padding: 10px 14px;
      border-radius: 10px;
      max-width: 60%;
      color: #166534;
      text-align: right;
    }

    /* Input area */
    .input-area {
      display: flex;
      gap: 10px;
      padding: 15px;
      border-top: 1px solid #e5e7eb;
    }

    .input-area input {
      flex: 1;
      padding: 10px;
      font-size: 16px;
      border-radius: 6px;
      border: 1px solid #ccc;
    }

    .input-area button {
      padding: 10px 20px;
      font-size: 16px;
      border: none;
      background: #2563eb;
      color: white;
      border-radius: 6px;
      cursor: pointer;
    }

    .input-area button:hover {
      background: #1e40af;
    }
  </style>
</head>

<body>

<div class="chat-wrapper">
  <div class="chat-header">üìä Investment Planning Chatbot</div>

  <div id="chat"></div>

  <div class="input-area">
    <input id="input" placeholder="Type here..." onkeydown="if(event.key==='Enter') send()" />
    <button onclick="send()">Send</button>
  </div>
</div>

<script>
let step = 0;
let data = {};

const chat = document.getElementById("chat");

function scrollBottom() {
  chat.scrollTop = chat.scrollHeight;
}

function bot(msg) {
  chat.innerHTML += `<div class="bot">ü§ñ ${msg}</div>`;
  scrollBottom();
}

function user(msg) {
  chat.innerHTML += `<div class="user">üßë ${msg}</div>`;
  scrollBottom();
}

bot("What is your monthly investment amount (‚Çπ)?");

async function send() {
  const input = document.getElementById("input");
  const value = input.value.trim();
  if (!value) return;

  user(value);
  input.value = "";

  switch (step) {
    case 0:
      data.monthly_investment = Number(value);
      bot("Expected annual increment (%)?");
      break;

    case 1:
      data.annual_increment = Number(value);
      bot("Equity allocation (%)?");
      break;

    case 2:
      data.equity_pct = Number(value) / 100;
      bot("Debt allocation (%)?");
      break;

    case 3:
      data.debt_pct = Number(value) / 100;
      bot("Gold allocation (%)?");
      break;

    case 4:
      data.gold_pct = Number(value) / 100;
      if (Math.round((data.equity_pct + data.debt_pct + data.gold_pct) * 100) !== 100) {
        bot("‚ùå Allocation must sum to 100%. Starting again.");
        step = -1;
        data = {};
        bot("What is your monthly investment amount (‚Çπ)?");
      } else {
        bot("Expected Equity return (%)?");
      }
      break;

    case 5:
      data.equity_return = Number(value);
      bot("Expected Debt return (%)?");
      break;

    case 6:
      data.debt_return = Number(value);
      bot("Expected Gold return (%)?");
      break;

    case 7:
      data.gold_return = Number(value);
      bot("Calculating your 20-year corpus...");
      await calculate();
      return;
  }

  step++;
}

async function calculate() {
  try {
    const response = await fetch("/calculate", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify(data)
    });

    if (!response.ok) {
      bot("‚ùå API Error occurred.");
      return;
    }

    const result = await response.json();

    bot(`üìà Equity Corpus: ‚Çπ${(result.equity_corpus / 100000).toFixed(2)} L`);
    bot(`üìâ Debt Corpus: ‚Çπ${(result.debt_corpus / 100000).toFixed(2)} L`);
    bot(`üü° Gold Corpus: ‚Çπ${(result.gold_corpus / 100000).toFixed(2)} L`);
    bot(`üí∞ Total Corpus: ‚Çπ${(result.total_corpus / 10000000).toFixed(2)} Cr`);
    bot("‚úÖ Calculation completed successfully!");

  } catch (error) {
    bot("‚ùå Network error. Please try again.");
    console.error(error);
  }
}
</script>

</body>
</html>